#!/usr/bin/with-contenv bashio
# ==============================================================================
# Start nginx for ingress support
# s6-overlay docs: https://github.com/just-containers/s6-overlay
# ==============================================================================

# Create temp directories for nginx
mkdir -p /tmp/nginx/client_body
mkdir -p /tmp/nginx/proxy
mkdir -p /tmp/nginx/fastcgi
mkdir -p /tmp/nginx/uwsgi
mkdir -p /tmp/nginx/scgi

bashio::log.info "Starting nginx with ingress token extraction and URL rewriting..."
bashio::log.info "This captures the HA ingress token and rewrites asset URLs properly"
bashio::log.info "Asset URLs will be rewritten to use full /api/hassio_ingress/TOKEN/path format"

# Start nginx
exec nginx -c /etc/nginx/nginx.conf