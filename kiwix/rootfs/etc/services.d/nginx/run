#!/usr/bin/with-contenv bashio
# ==============================================================================
# Start nginx for ingress support
# s6-overlay docs: https://github.com/just-containers/s6-overlay
# ==============================================================================

# Create temp directories for nginx
mkdir -p /tmp/nginx/client_body
mkdir -p /tmp/nginx/proxy
mkdir -p /tmp/nginx/fastcgi
mkdir -p /tmp/nginx/uwsgi
mkdir -p /tmp/nginx/scgi

bashio::log.info "Starting nginx with HTML rewriting for Home Assistant ingress..."
bashio::log.info "Sub_filter enabled to convert absolute asset URLs to relative paths"
bashio::log.info "This should fix CSS/JS loading issues in Home Assistant UI"

# Start nginx
exec nginx -c /etc/nginx/nginx.conf